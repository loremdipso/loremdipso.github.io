<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><title>Lithe 2: From Scratch</title><meta content="Continued exploration of Lithe, an attempt at re-writing the Svelte compiler in Rust" name=description><link href="/style.css?h=113f377b3ae52303efd1" integrity="sha256-ET83ezrlIwPv0VEg5Um8fx4qGJsUhKwPaUTyshbShXA=" crossorigin rel=stylesheet><link href="/post.css?h=618e029f323073604e10" integrity="sha256-YY4CnzIwc2BOEGNHgWXNaGjZyO9H+TjljQ/oWRSHwEg=" crossorigin rel=stylesheet><script src="/js/post-scroll.js?h=edfc3a547fcea064d0ad" async crossorigin></script><body><header class="app-header slide-in-from-top"><nav><a href=/>About</a><a class=active href=/posts/>Posts</a><a href=/minis/>Minis</a><a href=/projects/>Projects</a></nav><div class=socials><a rel="noopener me" href=https://www.linkedin.com/in/loremdipso/ target=_blank title=Linkedin> <span class=inline-svg> <svg viewbox="0 0 448 512" class=icon fill=#44bddc height=1em stroke=currentColor stroke-width=0 width=1em xmlns=http://www.w3.org/2000/svg><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg> </span> </a><a rel="noopener me" href=https://github.com/loremdipso target=_blank title=Github> <span class=inline-svg> <svg viewbox="0 0 496 512" class=icon fill=#44bddc height=1em stroke=currentColor stroke-width=0 width=1em xmlns=http://www.w3.org/2000/svg><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg> </span> </a></div></header><div class=content-wrapper><div class=content><div class=progress-bar></div><main><article><header class=post-header><h1>Lithe 2: From Scratch</h1><hr><div class=post-subheader><div class=post-metadata>Jan 03, 2022 · 1 minute read</div><div class=tags><a class=tag href=https://loremdipso.com/tags/devlog/> <span class=inline-svg> <svg class="feather feather-tag meta-icon" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1=7 x2=7 y1=7 y2=7></line></svg> </span> devlog </a><a class=tag href=https://loremdipso.com/tags/lithe/> <span class=inline-svg> <svg class="feather feather-tag meta-icon" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1=7 x2=7 y1=7 y2=7></line></svg> </span> lithe </a><a class=tag href=https://loremdipso.com/tags/svelte/> <span class=inline-svg> <svg class="feather feather-tag meta-icon" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1=7 x2=7 y1=7 y2=7></line></svg> </span> svelte </a></div></div><a href="https://github.com/loremdipso/loremdipso.github.io/issues/new?title=Issue with lithe-2&body=I found an issue on page 'Lithe 2: From Scratch'" class=feedback target=#>Found a mistake? Let me know!</a></header><div class=post-contents><p>I've written a little Rust, but never professionally, so I'm sure what I write is going to be ugly to those in the know. But it compiles, which is half the battle.<p>Before starting this project let's take a quick peek at the Svelte repo. Oh, huh, looks like the compiler smaller than I would have thought, weighing in at only ~800KB (if you include the runtime), but 800KB of code to rewrite is still fairly massive for a weekend warrior like myself. So, for my initial attempt I crafted the world's smallest svelte app:<pre class=language-html data-lang=html style=color:#cccece;background-color:#2b2c2f><code class=language-html data-lang=html><span style=color:#5fb3b3>&lt;</span><span style=color:#eb606b>span</span><span style=color:#5fb3b3>></span><span>Hello world!</span><span style=color:#5fb3b3>&lt;/</span><span style=color:#eb606b>span</span><span style=color:#5fb3b3>>
</span><span>
</span><span style=color:#5fb3b3>&lt;</span><span style=color:#eb606b>span</span><span style=color:#5fb3b3>></span><span>Goodbye!</span><span style=color:#5fb3b3>&lt;/</span><span style=color:#eb606b>span</span><span style=color:#5fb3b3>>
</span></code></pre><p>I ran that through a recent Svelte compiler to get:<pre class=language-js data-lang=js style=color:#cccece;background-color:#2b2c2f><code class=language-js data-lang=js><span style=color:#5f6364>/* generated by Svelte v3.44.3 */
</span><span style=color:#c594c5>import </span><span style=color:#5fb3b3>{
</span><span>	SvelteComponent</span><span style=color:#5fb3b3>,
</span><span>	detach</span><span style=color:#5fb3b3>,
</span><span>	element</span><span style=color:#5fb3b3>,
</span><span>	init</span><span style=color:#5fb3b3>,
</span><span>	insert</span><span style=color:#5fb3b3>,
</span><span>	noop</span><span style=color:#5fb3b3>,
</span><span>	safe_not_equal</span><span style=color:#5fb3b3>,
</span><span>	space</span><span style=color:#5fb3b3>,
</span><span style=color:#5fb3b3>} </span><span style=color:#c594c5>from </span><span style=color:#5fb3b3>"</span><span style=color:#99c794>svelte/internal</span><span style=color:#5fb3b3>";
</span><span>
</span><span style=color:#c594c5>function </span><span style=color:#69c>create_fragment</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>ctx</span><span style=color:#5fb3b3>) {
</span><span>	</span><span style=color:#c594c5>let </span><span>span0</span><span style=color:#5fb3b3>;
</span><span>	</span><span style=color:#c594c5>let </span><span>t1</span><span style=color:#5fb3b3>;
</span><span>	</span><span style=color:#c594c5>let </span><span>span1</span><span style=color:#5fb3b3>;
</span><span>
</span><span>	</span><span style=color:#c594c5>return </span><span style=color:#5fb3b3>{
</span><span>		</span><span style=color:#69c>c</span><span style=color:#5fb3b3>() {
</span><span>			span0 </span><span style=color:#5fb3b3>= </span><span style=color:#69c>element</span><span>(</span><span style=color:#5fb3b3>"</span><span style=color:#99c794>span</span><span style=color:#5fb3b3>"</span><span>)</span><span style=color:#5fb3b3>;
</span><span>			span0</span><span style=color:#5fb3b3>.</span><span>textContent </span><span style=color:#5fb3b3>= "</span><span style=color:#99c794>Hello world!</span><span style=color:#5fb3b3>";
</span><span>			t1 </span><span style=color:#5fb3b3>= </span><span style=color:#69c>space</span><span>()</span><span style=color:#5fb3b3>;
</span><span>			span1 </span><span style=color:#5fb3b3>= </span><span style=color:#69c>element</span><span>(</span><span style=color:#5fb3b3>"</span><span style=color:#99c794>span</span><span style=color:#5fb3b3>"</span><span>)</span><span style=color:#5fb3b3>;
</span><span>			span1</span><span style=color:#5fb3b3>.</span><span>textContent </span><span style=color:#5fb3b3>= "</span><span style=color:#99c794>Goodbye</span><span style=color:#5fb3b3>";
</span><span>		</span><span style=color:#5fb3b3>},
</span><span>		</span><span style=color:#69c>m</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>target</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>anchor</span><span style=color:#5fb3b3>) {
</span><span>			</span><span style=color:#69c>insert</span><span>(target</span><span style=color:#5fb3b3>, </span><span>span0</span><span style=color:#5fb3b3>, </span><span>anchor)</span><span style=color:#5fb3b3>;
</span><span>			</span><span style=color:#69c>insert</span><span>(target</span><span style=color:#5fb3b3>, </span><span>t1</span><span style=color:#5fb3b3>, </span><span>anchor)</span><span style=color:#5fb3b3>;
</span><span>			</span><span style=color:#69c>insert</span><span>(target</span><span style=color:#5fb3b3>, </span><span>span1</span><span style=color:#5fb3b3>, </span><span>anchor)</span><span style=color:#5fb3b3>;
</span><span>		</span><span style=color:#5fb3b3>},
</span><span>		p</span><span style=color:#5fb3b3>: </span><span>noop</span><span style=color:#5fb3b3>,
</span><span>		i</span><span style=color:#5fb3b3>: </span><span>noop</span><span style=color:#5fb3b3>,
</span><span>		o</span><span style=color:#5fb3b3>: </span><span>noop</span><span style=color:#5fb3b3>,
</span><span>		</span><span style=color:#69c>d</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>detaching</span><span style=color:#5fb3b3>) {
</span><span>			</span><span style=color:#c594c5>if </span><span>(detaching) </span><span style=color:#69c>detach</span><span>(span0)</span><span style=color:#5fb3b3>;
</span><span>			</span><span style=color:#c594c5>if </span><span>(detaching) </span><span style=color:#69c>detach</span><span>(t1)</span><span style=color:#5fb3b3>;
</span><span>			</span><span style=color:#c594c5>if </span><span>(detaching) </span><span style=color:#69c>detach</span><span>(span1)</span><span style=color:#5fb3b3>;
</span><span>		</span><span style=color:#5fb3b3>},
</span><span>	</span><span style=color:#5fb3b3>};
</span><span style=color:#5fb3b3>}
</span><span>
</span><span style=color:#c594c5>class </span><span style=color:#fac863>Component </span><span style=color:#c594c5>extends </span><span style=color:#99c794>SvelteComponent </span><span style=color:#5fb3b3>{
</span><span>	</span><span style=color:#c594c5>constructor</span><span style=color:#5fb3b3>(</span><span style=color:#f99157>options</span><span style=color:#5fb3b3>) {
</span><span>		</span><span style=color:#ec5f67>super</span><span>()</span><span style=color:#5fb3b3>;
</span><span>		</span><span style=color:#69c>init</span><span>(</span><span style=color:#ec5f67>this</span><span style=color:#5fb3b3>, </span><span>options</span><span style=color:#5fb3b3>, </span><span style=color:#f99157>null</span><span style=color:#5fb3b3>, </span><span>create_fragment</span><span style=color:#5fb3b3>, </span><span>safe_not_equal</span><span style=color:#5fb3b3>, {}</span><span>)</span><span style=color:#5fb3b3>;
</span><span>	</span><span style=color:#5fb3b3>}
</span><span style=color:#5fb3b3>}
</span></code></pre><p>Alright, seems simple enough. What if I just write a very very very basic compiler that parses the DOM tree looking for Elements and then spits out the resultant JavaScript as it chugs along? If we merge all the compilation steps we avoid running through the file multiple times, a plus for performance. So I gave it a shot, and got something that produced exactly the same output, but only for the simplest cases. After, I realized that, while this approach would yield something very very fast, doing everything in one step made the program fairly difficult to change. I think I'd be better off sacrificing just a little performance in exchange for modularity. Let's shelve this attempt for now and try something more traditional.</div></article><hr><div class=suggested-post-links><h3>Suggested reading</h3><a class=previous href=/posts/lithe-1> Previously: <b>Lithe 1: The Motivation</b> </a><a class=next href=/posts/lithe-3> Up next: <b>Lithe 3: A Rewrite</b> </a></div></main></div><footer class="app-footer fade-in"><p>© 2025  Michael Adams  <a href=/rss.xml target=_blank title=rss> <span class=inline-svg> <svg class="feather feather-rss" viewbox="0 0 24 24" fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx=5 cy=19 r=1></circle></svg> </span> </a></footer></div>